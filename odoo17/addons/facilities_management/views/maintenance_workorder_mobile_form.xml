<odoo>
    <!-- Enhanced Mobile List View for Technicians -->
    <record id="view_workorder_mobile_list" model="ir.ui.view">
        <field name="name">maintenance.workorder.mobile.list</field>
        <field name="model">maintenance.workorder</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <tree string="Work Orders (Mobile)" class="o_mobile_list">
                <field name="name"/>
                <field name="asset_id"/>
                <field name="building_id"/>
                <field name="status" widget="badge" decoration-info="status == 'draft'" decoration-warning="status == 'in_progress'" decoration-success="status == 'completed'" decoration-danger="status == 'cancelled'"/>
                <field name="priority" widget="badge" decoration-info="priority == '0'" decoration-warning="priority == '3'" decoration-danger="priority == '4'"/>
                <field name="sla_response_status" widget="badge" decoration-info="sla_response_status == 'on_time'" decoration-warning="sla_response_status == 'at_risk'" decoration-danger="sla_response_status == 'breached'"/>
                <field name="sla_resolution_status" widget="badge" decoration-info="sla_resolution_status == 'on_time'" decoration-warning="sla_resolution_status == 'at_risk'" decoration-danger="sla_resolution_status == 'breached'"/>
            </tree>
        </field>
    </record>

    <!-- Enhanced Mobile Form View for Technicians -->
    <record id="view_workorder_mobile_enhanced_form" model="ir.ui.view">
        <field name="name">maintenance.workorder.mobile.enhanced.form</field>
        <field name="model">maintenance.workorder</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <form string="Work Order (Mobile)" class="o_mobile_form">
                <header>
                    <field name="status" invisible="1"/>
                    <field name="approval_state" invisible="1"/>
                    <field name="work_order_type" invisible="1"/>
                    <field name="schedule_id" invisible="1"/>
                    <field name="job_plan_id" invisible="1"/>

                    <group>
                        <group>
                            <field name="status" widget="badge" readonly="1"/>
                        </group>
                        <group>
                            <field name="priority" widget="badge" readonly="1"/>
                        </group>
                    </group>

                    <div class="d-flex flex-wrap gap-2 mb-3">
                        <button name="action_start_progress" type="object" string="Start Work" class="btn btn-primary btn-lg"
                            invisible="status not in ('draft', 'assigned') or approval_state not in ('approved', 'draft', 'submitted', 'supervisor', 'manager')"
                            icon="fa-play"/>
                        <button name="action_quick_start" type="object" string="Quick Start" class="btn btn-success btn-lg"
                            invisible="status != 'draft' or approval_state != 'draft'"
                            icon="fa-bolt"/>
                        <button name="action_resume_work" type="object" string="Resume" class="btn btn-warning btn-lg"
                            invisible="status != 'on_hold'"
                            icon="fa-refresh"/>
                        <button name="action_complete" type="object" string="Complete" class="btn btn-success btn-lg"
                            invisible="status != 'in_progress'"
                            icon="fa-check"/>
                        <button name="action_stop_work" type="object" string="Stop Work" class="btn btn-danger btn-lg"
                            invisible="status != 'in_progress'"
                            icon="fa-stop"/>
                    </div>
                </header>

                <sheet>
                    <div class="oe_title text-center mb-4">
                        <h1 class="text-primary"><field name="name" readonly="1"/></h1>
                        <p class="text-muted"><field name="work_order_type" readonly="1"/></p>
                        <div class="alert alert-warning mt-2" invisible="work_order_type != 'preventive' or job_plan_id" role="alert">No job plan linked. Tasks are not available.</div>
                    </div>

                    <group string="SLA Status" colspan="2">
                        <group>
                            <field name="sla_response_status" widget="badge" readonly="1"/>
                            <field name="sla_response_deadline" readonly="1"/>
                        </group>
                        <group>
                            <field name="sla_resolution_status" widget="badge" readonly="1"/>
                            <field name="sla_resolution_deadline" readonly="1"/>
                        </group>
                    </group>

                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fa fa-cog me-2"></i>Asset Information</h5>
                        </div>
                        <div class="card-body">
                            <group>
                                <group>
                                    <field name="asset_id" readonly="1"/>
                                    <field name="facility_id" readonly="1"/>
                                </group>
                                <group>
                                    <field name="building_id" readonly="1"/>
                                    <field name="room_id" readonly="1"/>
                                </group>
                            </group>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-info-circle me-2"></i>Work Order Details</h5>
                        </div>
                        <div class="card-body">
                            <group>
                                <group>
                                    <field name="description" readonly="1"/>
                                    <field name="technician_id" readonly="1"/>
                                </group>
                                <group>
                                    <field name="start_date" readonly="1"/>
                                    <field name="end_date" readonly="1"/>
                                </group>
                            </group>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fa fa-clock-o me-2"></i>Time Tracking</h5>
                        </div>
                        <div class="card-body">
                            <group>
                                <group>
                                    <field name="actual_start_date" readonly="status in ('completed', 'cancelled')"/>
                                    <field name="estimated_duration" readonly="1"/>
                                </group>
                                <group>
                                    <field name="actual_end_date" readonly="status in ('draft', 'assigned', 'cancelled')"/>
                                    <field name="actual_duration" readonly="1"/>
                                </group>
                            </group>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0"><i class="fa fa-wrench me-2"></i>Parts &amp; Labor</h5>
                        </div>
                        <div class="card-body">
                            <group>
                                <group>
                                    <field name="labor_cost" readonly="status in ('completed', 'cancelled')"/>
                                </group>
                                <group>
                                    <field name="parts_cost" readonly="1"/>
                                </group>
                            </group>
                            <field name="parts_used_ids" readonly="status != 'in_progress'" nolabel="1">
                                <tree editable="bottom">
                                    <field name="product_id"/>
                                    <field name="quantity"/>
                                </tree>
                            </field>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mb-4" invisible="work_order_type != 'preventive'">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-tasks me-2"></i>Maintenance Tasks</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info" role="alert" invisible="schedule_id and job_plan_id">
                                <i class="fa fa-info-circle me-2" title="Information"></i>
                                <strong>Tasks are auto-generated from the job plan linked to this maintenance schedule.</strong>
                            </div>
                            
                            <div class="alert alert-warning" role="alert" invisible="schedule_id and job_plan_id">
                                <i class="fa fa-exclamation-triangle me-2" title="Warning"></i>
                                <strong>No job plan linked to this preventive workorder. Tasks are not available.</strong>
                                <p class="mb-0">Please ensure the workorder has a linked maintenance schedule with a job plan to see tasks.</p>
                            </div>

                            <field name="workorder_task_ids" create="false" invisible="not (schedule_id and job_plan_id)">
                                <tree editable="bottom">
                                    <field name="section_id"/>
                                    <field name="name" readonly="1"/>
                                    <field name="description" readonly="1"/>
                                    <field name="is_done" widget="boolean_toggle" readonly="workorder_status != 'in_progress'"/>
                                    <field name="before_image" widget="image" optional="show" string="Before"/>
                                    <field name="after_image" widget="image" optional="show" string="After"/>
                                    <button name="toggle_task_completion" type="object" string="Toggle" class="btn btn-secondary btn-sm" invisible="workorder_status != 'in_progress'"/>
                                </tree>
                                <form string="Task">
                                    <header>
                                        <field name="workorder_status" invisible="1"/>
                                        <div class="alert alert-info" role="alert" invisible="workorder_status == 'in_progress'">
                                            <i class="fa fa-info-circle me-2"></i>
                                            <strong>Work Order must be "In Progress" to complete tasks and upload images.</strong>
                                        </div>
                                    </header>
                                    <group>
                                        <group>
                                            <field name="section_id" readonly="1"/>
                                            <field name="name" readonly="1"/>
                                        </group>
                                        <field name="description" readonly="1"/>
                                        <field name="is_done" widget="boolean_toggle" readonly="workorder_status != 'in_progress'"/>
                                        <group>
                                            <field name="duration" readonly="1"/>
                                        </group>
                                        <group string="Before/After Images" invisible="workorder_status != 'in_progress'">
                                            <field name="before_image" widget="image" string="Before Image" help="Upload image before starting the task"/>
                                            <field name="after_image" widget="image" string="After Image" help="Upload image after completing the task"/>
                                        </group>
                                        <group string="Images (Read-only)" invisible="workorder_status == 'in_progress'">
                                            <field name="before_image" widget="image" string="Before Image" readonly="1"/>
                                            <field name="after_image" widget="image" string="After Image" readonly="1"/>
                                        </group>
                                        <field name="notes" placeholder="Add notes about the task execution..." readonly="workorder_status not in ('in_progress',)"/>
                                    </group>
                                </form>
                            </field>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-sticky-note me-2"></i>Work Summary &amp; Notes</h5>
                        </div>
                        <div class="card-body">
                            <field name="work_done" placeholder="Describe the work performed, issues found, and solutions applied..." readonly="status == 'cancelled'"/>
                            <group>
                                <group>
                                    <field name="first_time_fix" widget="boolean_toggle" readonly="status in ('draft', 'assigned', 'cancelled')"/>
                                </group>
                                <group>
                                    <field name="service_type" readonly="status in ('completed', 'cancelled')"/>
                                </group>
                            </group>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Mobile Window Action for Work Orders -->
    <record id="action_maintenance_workorder_mobile" model="ir.actions.act_window">
        <field name="name">Work Orders (Mobile)</field>
        <field name="res_model">maintenance.workorder</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('facilities_management.view_workorder_mobile_list')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('facilities_management.view_workorder_mobile_enhanced_form')})]"/>
        <field name="context">{'mobile_view': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first work order!
            </p>
            <p>
                Manage maintenance work orders with mobile-optimized interface for technicians.
            </p>
        </field>
    </record>

    <!-- Client action for enhanced mobile work orders -->
    <record id="action_maintenance_workorder_mobile_enhanced_client" model="ir.actions.client">
        <field name="name">Work Orders (Mobile Enhanced)</field>
        <field name="tag">mobile_workorders_enhanced</field>
        <field name="context">{}</field>
    </record>
</odoo>