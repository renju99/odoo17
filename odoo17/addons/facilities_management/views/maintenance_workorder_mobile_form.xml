<odoo>
    <!-- Enhanced Mobile List View for Technicians -->
    <record id="view_workorder_mobile_list" model="ir.ui.view">
        <field name="name">maintenance.workorder.mobile.list</field>
        <field name="model">maintenance.workorder</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <tree string="Work Orders (Mobile)" class="o_mobile_list">
                <field name="name"/>
                <field name="asset_id"/>
                <field name="building_id"/>
                <field name="status" widget="badge" decoration-info="status == 'draft'" decoration-warning="status == 'in_progress'" decoration-success="status == 'completed'" decoration-danger="status == 'cancelled'"/>
                <field name="priority" widget="badge" decoration-info="priority == '0'" decoration-warning="priority == '3'" decoration-danger="priority == '4'"/>
                <field name="sla_response_status" widget="badge" decoration-info="sla_response_status == 'on_time'" decoration-warning="sla_response_status == 'at_risk'" decoration-danger="sla_response_status == 'breached'"/>
                <field name="sla_resolution_status" widget="badge" decoration-info="sla_resolution_status == 'on_time'" decoration-warning="sla_resolution_status == 'at_risk'" decoration-danger="sla_resolution_status == 'breached'"/>
            </tree>
        </field>
    </record>

    <!-- Enhanced Mobile Form View for Technicians -->
    <record id="view_workorder_mobile_enhanced_form" model="ir.ui.view">
        <field name="name">maintenance.workorder.mobile.enhanced.form</field>
        <field name="model">maintenance.workorder</field>
        <field name="priority" eval="25"/>
        <field name="arch" type="xml">
            <form string="Work Order (Mobile)" class="o_mobile_form">
                <header>
                    <field name="status" invisible="1"/>
                    <field name="approval_state" invisible="1"/>
                    <field name="work_order_type" invisible="1"/>
                    
                    <!-- Status Badge -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="badge badge-lg" t-attf-class="badge-#{status == 'draft' and 'info' or status == 'in_progress' and 'warning' or status == 'completed' and 'success' or 'danger'}">
                            <field name="status" readonly="1"/>
                        </div>
                        <div class="badge badge-lg" t-attf-class="badge-#{priority == '0' and 'info' or priority == '3' and 'warning' or priority == '4' and 'danger' or 'secondary'}">
                            <field name="priority" readonly="1"/>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex flex-wrap gap-2 mb-3">
                        <button name="action_start_progress" type="object" string="Start Work" class="btn btn-primary btn-lg"
                            invisible="status not in ('draft', 'assigned') or approval_state not in ('approved', 'draft', 'submitted', 'supervisor', 'manager')"
                            icon="fa-play"/>
                        <button name="action_quick_start" type="object" string="Quick Start" class="btn btn-success btn-lg"
                            invisible="status != 'draft' or approval_state != 'draft'"
                            icon="fa-bolt"/>
                        <button name="action_resume_work" type="object" string="Resume" class="btn btn-warning btn-lg"
                            invisible="status != 'on_hold'"
                            icon="fa-refresh"/>
                        <button name="action_complete" type="object" string="Complete" class="btn btn-success btn-lg"
                            invisible="status != 'in_progress'"
                            icon="fa-check"/>
                        <button name="action_stop_work" type="object" string="Stop Work" class="btn btn-danger btn-lg"
                            invisible="status != 'in_progress'"
                            icon="fa-stop"/>
                    </div>
                </header>
                
                <sheet>
                    <!-- Work Order Header -->
                    <div class="oe_title text-center mb-4">
                        <h1 class="text-primary"><field name="name" readonly="1"/></h1>
                        <p class="text-muted"><field name="work_order_type" readonly="1"/></p>
                    </div>

                    <!-- SLA Status Cards -->
                    <div class="row mb-4">
                        <div class="col-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-dark">Response SLA</h6>
                                    <div class="badge badge-lg" t-attf-class="badge-#{sla_response_status == 'on_time' and 'success' or sla_response_status == 'at_risk' and 'warning' or 'danger'}">
                                        <field name="sla_response_status" readonly="1"/>
                                    </div>
                                    <small class="text-dark d-block mt-1">
                                        <field name="sla_response_deadline" readonly="1"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <h6 class="card-title text-dark">Resolution SLA</h6>
                                    <div class="badge badge-lg" t-attf-class="badge-#{sla_resolution_status == 'on_time' and 'success' or sla_resolution_status == 'at_risk' and 'warning' or 'danger'}">
                                        <field name="sla_resolution_status" readonly="1"/>
                                    </div>
                                    <small class="text-dark d-block mt-1">
                                        <field name="sla_resolution_deadline" readonly="1"/>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Asset Information -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fa fa-cog me-2"></i>Asset Information</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Asset:</label>
                                    <p class="text-dark"><field name="asset_id" readonly="1"/></p>
                                </div>
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Building:</label>
                                    <p class="text-dark"><field name="building_id" readonly="1"/></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Facility:</label>
                                    <p class="text-dark"><field name="facility_id" readonly="1"/></p>
                                </div>
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Room:</label>
                                    <p class="text-dark"><field name="room_id" readonly="1"/></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Work Order Details -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-info-circle me-2"></i>Work Order Details</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Description:</label>
                                    <p class="text-dark"><field name="description" readonly="1"/></p>
                                </div>
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Technician:</label>
                                    <p class="text-dark"><field name="technician_id" readonly="1"/></p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">Start Date:</label>
                                    <p class="text-dark"><field name="start_date" readonly="1"/></p>
                                </div>
                                <div class="col-6">
                                    <label class="text-dark font-weight-bold">End Date:</label>
                                    <p class="text-dark"><field name="end_date" readonly="1"/></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tasks Section - Only for Planned Work Orders -->
                    <div class="card border-0 shadow-sm mb-4" invisible="work_order_type != 'preventive'">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-tasks me-2"></i>Maintenance Tasks</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fa fa-info-circle me-2"></i>
                                <strong>Tasks are auto-generated from the job plan linked to this maintenance schedule.</strong>
                            </div>
                            
                            <!-- Tasks List -->
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th class="text-white">Task</th>
                                            <th class="text-white">Section</th>
                                            <th class="text-white">Status</th>
                                            <th class="text-white">Duration</th>
                                            <th class="text-white">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr t-foreach="workorder_task_ids" t-as="task">
                                            <td class="text-dark">
                                                <strong><t t-esc="task.name"/></strong>
                                                <br/>
                                                <small class="text-muted"><t t-esc="task.description"/></small>
                                            </td>
                                            <td class="text-dark"><t t-esc="task.section_id.name"/></td>
                                            <td>
                                                <span class="badge" t-attf-class="badge-#{task.is_done and 'success' or 'warning'}">
                                                    <t t-esc="task.is_done and 'Completed' or 'Pending'"/>
                                                </span>
                                            </td>
                                            <td class="text-dark"><t t-esc="task.duration"/> hours</td>
                                            <td>
                                                <button type="object" name="action_toggle_task_completion" 
                                                        class="btn btn-sm" 
                                                        t-attf-class="btn-#{task.is_done and 'outline-success' or 'success'}"
                                                        t-att-args="(task.id,)"
                                                        t-att-data-task-id="task.id">
                                                    <i class="fa" t-attf-class="fa-#{task.is_done and 'check' or 'play'}"></i>
                                                    <t t-esc="task.is_done and 'Completed' or 'Mark Done'"/>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Task Progress -->
                            <div class="mt-3">
                                <div class="progress">
                                    <div class="progress-bar bg-success" role="progressbar" 
                                         t-attf-style="width: #{len([t for t in workorder_task_ids if t.is_done]) / len(workorder_task_ids) * 100}%">
                                        <span class="text-white">
                                            <t t-esc="len([t for t in workorder_task_ids if t.is_done])"/> / <t t-esc="len(workorder_task_ids)"/> Tasks Completed
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Before Image -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="fa fa-camera me-2"></i>Before Image</h5>
                        </div>
                        <div class="card-body text-center">
                            <field name="before_image" widget="image" class="img-fluid" style="max-width: 100%; height: auto;"/>
                            <div class="mt-3">
                                <button type="object" name="action_upload_before_image" class="btn btn-outline-warning">
                                    <i class="fa fa-upload me-2"></i>Upload Before Image
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- After Image -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fa fa-camera me-2"></i>After Image</h5>
                        </div>
                        <div class="card-body text-center">
                            <field name="after_image" widget="image" class="img-fluid" style="max-width: 100%; height: auto;"/>
                            <div class="mt-3">
                                <button type="object" name="action_upload_after_image" class="btn btn-outline-success">
                                    <i class="fa fa-upload me-2"></i>Upload After Image
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Technician Notes -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fa fa-sticky-note me-2"></i>Technician Notes</h5>
                        </div>
                        <div class="card-body">
                            <field name="notes" placeholder="Add your notes about this task..."/>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action for Mobile Work Orders -->
    <record id="action_maintenance_workorder_mobile_enhanced" model="ir.actions.act_window">
        <field name="name">Work Orders (Mobile Enhanced)</field>
        <field name="res_model">maintenance.workorder</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_workorder_mobile_enhanced_form"/>
        <field name="context">{}</field>
    </record>

    <!-- Menu item for enhanced mobile work orders -->
    <menuitem id="menu_maintenance_workorder_mobile_enhanced"
              name="Work Orders (Mobile Enhanced)"
              parent="menu_maintenance_operations"
              action="action_maintenance_workorder_mobile_enhanced"
              sequence="15"
              groups="base.group_user"/>
</odoo>