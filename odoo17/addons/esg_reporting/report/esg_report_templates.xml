<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Main ESG Report Template -->
        <template id="esg_reporting_main_template">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="container mt-5">
                                <!-- Report Header -->
                                <div class="row mb-4">
                                    <div class="col-8">
                                        <h1 t-esc="data.get('report_info', {}).get('name', 'Enhanced ESG Report')"/>
                                        <p class="lead" t-esc="data.get('report_info', {}).get('type', 'sustainability')"/>
                                    </div>
                                    <div class="col-4 text-right">
                                        <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" style="max-height: 80px;" alt="Company Logo"/>
                                        <h4 t-esc="data.get('report_info', {}).get('company', '')"/>
                                    </div>
                                </div>

                                <!-- Report Info -->
                                <div class="row mb-4 p-3 bg-light rounded">
                                    <div class="col-4">
                                        <strong>Date From:</strong>
                                        <span t-esc="data.get('report_info', {}).get('date_from', '')"/>
                                    </div>
                                    <div class="col-4">
                                        <strong>Date To:</strong>
                                        <span t-esc="data.get('report_info', {}).get('date_to', '')"/>
                                    </div>
                                    <div class="col-4">
                                        <strong>Generated At:</strong>
                                        <span t-esc="data.get('report_info', {}).get('generated_at', '')"/>
                                    </div>
                                </div>

                                <!-- Note if no assets found -->
                                <t t-if="data.get('report_info', {}).get('note')">
                                    <div class="alert alert-warning" role="alert">
                                        <h4 class="alert-heading">Data Notice</h4>
                                        <p t-esc="data.get('report_info', {}).get('note', '')"/>
                                    </div>
                                </t>

                                <!-- Environmental Metrics -->
                                <t t-if="data.get('environmental_metrics')">
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <h2>Environmental Metrics</h2>
                                            <table class="table table-sm table-bordered">
                                                <tbody>
                                                    <tr>
                                                        <th>Total Carbon Footprint</th>
                                                        <td t-esc="data['environmental_metrics'].get('total_carbon_footprint', 0)"/>
                                                    </tr>
                                                    <tr>
                                                        <th>Energy Efficiency Score</th>
                                                        <td t-esc="data['environmental_metrics'].get('energy_efficiency_score', 0)"/>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </t>

                                <!-- Social Metrics -->
                                <t t-if="data.get('social_metrics')">
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <h2>Social Metrics</h2>
                                            <table class="table table-sm table-bordered">
                                                <tbody>
                                                    <tr>
                                                        <th>Community Impact Score</th>
                                                        <td t-esc="data['social_metrics'].get('community_impact_score', 0)"/>
                                                    </tr>
                                                    <tr>
                                                        <th>Employee Satisfaction</th>
                                                        <td t-esc="data['social_metrics'].get('employee_satisfaction', 0)"/>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </t>

                                <!-- Governance Metrics -->
                                <t t-if="data.get('governance_metrics')">
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <h2>Governance Metrics</h2>
                                            <table class="table table-sm table-bordered">
                                                <tbody>
                                                    <tr>
                                                        <th>Compliance Rate</th>
                                                        <td t-esc="data['governance_metrics'].get('compliance_rate', 0)"/>
                                                    </tr>
                                                    <tr>
                                                        <th>Risk Management Score</th>
                                                        <td t-esc="data['governance_metrics'].get('risk_management_score', 0)"/>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </t>

                                <!-- Recommendations -->
                                <t t-if="data.get('recommendations')">
                                    <div class="row mt-4">
                                        <div class="col-12">
                                            <h2>Recommendations</h2>
                                            <ul class="list-group">
                                                <t t-foreach="data['recommendations']" t-as="rec">
                                                    <li class="list-group-item">
                                                        <strong t-esc="rec.get('category', '')"/>:
                                                        <span t-esc="rec.get('recommendation', '')"/>
                                                    </li>
                                                </t>
                                            </ul>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

        <!-- Fallback Template -->
        <template id="esg_reporting_fallback_template">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="container mt-5">
                            <div class="alert alert-danger" role="alert">
                                <h4 class="alert-heading">Report Generation Error</h4>
                                <p>An unexpected error occurred while generating the ESG report. Please check the server logs for more details or contact your administrator.</p>
                                <hr/>
                                <p class="mb-0">You can try regenerating the report with different parameters.</p>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>